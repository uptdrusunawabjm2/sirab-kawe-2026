<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Rusunawa</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-950 text-gray-100 min-h-screen">

<div class="max-w-7xl mx-auto p-6">

<h1 class="text-3xl font-bold mb-8 flex items-center gap-2">
  ğŸ¢ Rusunawa Kota Banjarmasin
</h1>

<!-- DASHBOARD GLOBAL -->
<div id="cards" class="grid grid-cols-1 md:grid-cols-5 gap-5 mb-12"></div>

<!-- DASHBOARD PER RUSUN -->
<h2 class="text-xl font-bold mb-4">ğŸ˜ï¸ Dashboard per Rusun</h2>
<div id="perRusun" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>

<!-- DASHBOARD BLOK GM -->
<h2 class="text-xl font-bold mt-10 mb-4">ğŸ¢ Ganda Maghfirah per Blok</h2>
<div id="perBlokGM" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

<p id="lastUpdate" class="text-gray-400 text-sm mt-10"></p>

</div>

<script>
async function load(){
  const r = await fetch('/api/data?action=public');
  const j = await r.json();
  const d = j.data;

  const g = d.global;
  const persenGlobal = g.total ? ((g.terisi / g.total) * 100).toFixed(1) : 0;

  /* ===== GLOBAL ===== */
  cards.innerHTML = `
    ${card("Total Unit", g.total, "from-slate-700 to-slate-800")}
    ${card("Siap Huni", g.siap, "from-green-600 to-green-700")}
    ${card("Terisi", g.terisi, "from-blue-600 to-blue-700")}
    ${card("Rusak", g.rusak, "from-red-600 to-red-700")}
    ${card("Hunian", persenGlobal + " %", "from-purple-600 to-purple-700")}
  `;

  /* ===== PER RUSUN ===== */
  renderPanel(perRusun, d.perRusun);

  /* ===== PER BLOK GM ===== */
  renderPanel(perBlokGM, d.perBlokGM);

  lastUpdate.innerText = "Update terakhir: " + new Date().toLocaleString("id-ID");
}

function renderPanel(container, data){
  let html="";
  Object.keys(data).forEach(k=>{
    const x = data[k];
    const persen = x.total ? ((x.terisi/x.total)*100).toFixed(1) : 0;

    html += `
    <div class="bg-gradient-to-br from-gray-900 to-gray-800 p-6 rounded-2xl shadow-xl border border-gray-800">
      <h3 class="text-lg font-bold mb-4">${k}</h3>
      <div class="grid grid-cols-2 gap-3 text-sm">
        <div>Total Unit</div><div class="text-right font-bold">${x.total}</div>
        <div>Terisi</div><div class="text-right text-blue-400 font-bold">${x.terisi}</div>
        <div>Siap Huni</div><div class="text-right text-green-400 font-bold">${x.siap}</div>
        <div>Rusak</div><div class="text-right text-red-400 font-bold">${x.rusak}</div>
        <div>Hunian</div><div class="text-right text-purple-400 font-bold">${persen} %</div>
      </div>
    </div>`;
  });
  container.innerHTML = html;
}

function card(title, value, gradient){
  return `
  <div class="bg-gradient-to-br ${gradient} p-7 rounded-2xl shadow-xl">
    <div class="text-sm opacity-80 mb-1">${title}</div>
    <div class="text-4xl font-bold tracking-wide">${value}</div>
  </div>`;
}

load();
setInterval(load, 60000);
</script>

</body>
</html>
