<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Rusunawa</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
#sidebar { transition: transform 0.3s ease; }
</style>
</head>

<body class="bg-gray-950 text-gray-100 min-h-screen">

<!-- ================= SIDEBAR KIRI ================= -->
<div id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-slate-900 border-r border-slate-700 p-5 z-50 -translate-x-full">

  <h2 class="text-lg font-bold mb-4">ðŸ“Š Capaian 2026</h2>

  <div class="space-y-4">

    <div class="bg-slate-800 p-4 rounded-xl">
      <div class="text-sm opacity-70">Realisasi</div>
      <div id="sbRealisasi" class="text-2xl font-bold mt-1">Rp 0</div>
    </div>

    <div class="bg-slate-800 p-4 rounded-xl">
      <div class="text-sm opacity-70">Target 2026</div>
      <div id="sbTarget" class="text-2xl font-bold mt-1">Rp 700.000.000</div>
    </div>

    <div class="bg-slate-800 p-4 rounded-xl">
      <div class="text-sm opacity-70">Persentase</div>
      <div id="sbPersen" class="text-2xl font-bold mt-1">0%</div>
    </div>

  </div>
</div>

<button onclick="toggleSidebar()" 
class="fixed top-5 left-5 z-50 bg-slate-800 hover:bg-slate-700 px-3 py-2 rounded-xl shadow">
â˜°
</button>
<!-- ================= END SIDEBAR ================= -->


<div class="max-w-7xl mx-auto p-6">

<h1 class="text-3xl font-bold mb-8 flex items-center justify-center gap-2 text-center">
  Rusunawa Kota Banjarmasin
</h1>

<div id="cards" class="grid grid-cols-1 md:grid-cols-5 gap-5 mb-12"></div>

<h2 class="text-xl font-bold mb-4"></h2>
<div id="perRusun" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>

<h2 class="text-xl font-bold mt-10 mb-4">Rusunawa Ganda Maghfirah per Blok</h2>
<div id="perBlokGM" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

<p id="lastUpdate" class="text-gray-400 text-sm mt-10"></p>

</div>

<script>
async function load(){
  const r = await fetch('/api/data?action=public');
  const j = await r.json();
  const d = j.data;

  const g = d.global;
  const persenGlobal = g.total ? ((g.terisi / g.total) * 100).toFixed(1) : 0;

  cards.innerHTML = `
    ${card("Total Unit", g.total, "from-slate-700 to-slate-800")}
    ${card("Siap Huni", g.siap, "from-green-600 to-green-700")}
    ${card("Terisi", g.terisi, "from-blue-600 to-blue-700")}
    ${card("Rusak", g.rusak, "from-red-600 to-red-700")}
    ${card("Persentase", persenGlobal + " %", "from-purple-600 to-purple-700")}
  `;

  renderPanel(perRusun, d.perRusun);
  renderPanel(perBlokGM, d.perBlokGM);

  lastUpdate.innerText = "Update terakhir: " + new Date().toLocaleString("id-ID");
}

function renderPanel(container, data){
  let html="";
  Object.keys(data).forEach(k=>{
    const x = data[k];
    const persen = x.total ? ((x.terisi/x.total)*100).toFixed(1) : 0;

    let subtitle = "";

    if(k === "Ganda Maghfirah"){
      subtitle = `<div class="text-xs text-slate-400 mt-1">
        Jl. Tembus Mantuil RT.022, Kel. Kelayan Selatan, Kec. Banjarmasin Selatan, Kota Banjarmasin
      </div>`;
    }

    if(k === "Teluk Kelayan"){
      subtitle = `<div class="text-xs text-slate-400 mt-1">
        Jl. Teluk Kelayan RT.001, Kel. Kelayan Barat, Kec. Banjarmasin Selatan, Kota Banjarmasin
      </div>`;
    }

    html += `
    <div class="bg-gradient-to-br from-gray-900 to-gray-800 p-6 rounded-2xl shadow-xl border border-gray-800">
      <h3 class="text-lg font-bold mb-1">Rusunawa ${k}</h3>
      ${subtitle}
      <div class="grid grid-cols-2 gap-3 text-sm mt-4">
        <div>Total Unit</div><div class="text-right font-bold">${x.total}</div>
        <div>Terisi</div><div class="text-right text-blue-400 font-bold">${x.terisi}</div>
        <div>Siap Huni</div><div class="text-right text-green-400 font-bold">${x.siap}</div>
        <div>Rusak</div><div class="text-right text-red-400 font-bold">${x.rusak}</div>
        <div>Persentase</div><div class="text-right text-purple-400 font-bold">${persen} %</div>
      </div>
    </div>`;
  });

  container.innerHTML = html;
}

function card(title, value, gradient){
  return `
  <div class="bg-gradient-to-br ${gradient} p-7 rounded-2xl shadow-xl">
    <div class="text-sm opacity-80 mb-1">${title}</div>
    <div class="text-4xl font-bold tracking-wide">${value}</div>
  </div>`;
}

load();
setInterval(load, 60000);
</script>

<script>
const TARGET_2026 = 700000000;

function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("-translate-x-full");
}

async function loadSidebar(){
  try{
    const r = await fetch('/api/data?action=sheet2');
    const j = await r.json();
    const data = j.data || [];

    let total = 0;
    data.forEach(x=>{
      total += Number(x.jumlah2025 || 0);
      total += Number(x.jumlah2026 || 0);
    });

    document.getElementById("sbRealisasi").innerText = formatRp(total);
    document.getElementById("sbTarget").innerText = formatRp(TARGET_2026);

    const persen = TARGET_2026 ? ((total / TARGET_2026) * 100).toFixed(2) : 0;
    document.getElementById("sbPersen").innerText = persen + " %";

  }catch(e){
    console.error("Sidebar error:", e);
  }
}

function formatRp(x){
  return "Rp " + x.toLocaleString("id-ID");
}

loadSidebar();
setInterval(loadSidebar, 60000);
</script>

</body>
</html>


