<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Informasi Unit Penghuni</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            bg: '#020617',
            card: '#0f172a',
            line: '#1e293b'
          }
        }
      }
    }
  </script>
</head>

<body class="dark bg-bg text-slate-200 min-h-screen">
  <div class="max-w-4xl mx-auto px-4 py-8 space-y-6">

    <!-- HEADER -->
    <header class="text-center space-y-1">
      <h1 class="text-2xl font-bold text-white">
        Rusunawa Kota Banjarmasin
      </h1>
      <p class="text-slate-400 text-sm">
        Informasi Unit Penghuni (Read Only)
      </p>
    </header>

    <!-- ALERT -->
    <div id="alert" class="hidden rounded-lg px-4 py-3 text-sm"></div>

    <!-- CARD UNIT -->
    <section id="card-unit" class="hidden bg-card border border-line rounded-xl p-5 space-y-4">
      <div class="flex justify-between items-center">
        <h2 class="text-lg font-semibold text-white">
          Unit <span id="unit-no"></span>
        </h2>
        <span id="kondisi"
          class="px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-200">
        </span>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <div>
          <div class="text-slate-400">Nama Penghuni</div>
          <div id="nama" class="font-medium text-white"></div>
        </div>
      </div>
    </section>

    <!-- RIWAYAT PERJANJIAN -->
    <section id="riwayat-perjanjian" class="hidden bg-card border border-line rounded-xl p-5">
      <h3 class="font-semibold text-white mb-3">Riwayat Perjanjian</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm border border-line">
          <thead class="bg-slate-800">
            <tr>
              <th class="px-3 py-2 text-left">No</th>
              <th class="px-3 py-2 text-left">No Perjanjian</th>
              <th class="px-3 py-2 text-left">Mulai</th>
              <th class="px-3 py-2 text-left">Akhir</th>
            </tr>
          </thead>
          <tbody id="tbl-perjanjian" class="divide-y divide-line"></tbody>
        </table>
      </div>
    </section>

    <!-- RIWAYAT TUNGGAKAN -->
    <section id="riwayat-tunggakan" class="hidden bg-card border border-line rounded-xl p-5">
      <h3 class="font-semibold text-white mb-3">Riwayat Tunggakan</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm border border-line">
          <thead class="bg-slate-800">
            <tr>
              <th class="px-3 py-2 text-left">Nama</th>
              <th class="px-3 py-2 text-right">2024</th>
              <th class="px-3 py-2 text-right">2025</th>
              <th class="px-3 py-2 text-right">2026</th>
            </tr>
          </thead>
          <tbody id="tbl-tunggakan" class="divide-y divide-line"></tbody>
        </table>
      </div>
    </section>

    <footer class="text-center text-xs text-slate-500 pt-4">
      Data ini bersifat informatif & tidak dapat diubah.
    </footer>

  </div>

  <script>
    const GAS_URL = "PASTE_URL_GAS_ANDA_DI_SINI";

    const qs = new URLSearchParams(location.search);
    const token = qs.get("token");

    const alertBox = document.getElementById("alert");

    function showAlert(msg, type = "error") {
      alertBox.className =
        "rounded-lg px-4 py-3 text-sm " +
        (type === "error"
          ? "bg-red-900/40 text-red-200 border border-red-800"
          : "bg-green-900/40 text-green-200 border border-green-800");
      alertBox.textContent = msg;
      alertBox.classList.remove("hidden");
    }

    if (!token) {
      showAlert("Token tidak ditemukan di URL");
      throw new Error("No token");
    }

    fetch(`${GAS_URL}?action=unit&token=${token}`)
      .then(r => r.json())
      .then(res => {
        if (!res.status) {
          showAlert(res.message || "Gagal memuat data");
          return;
        }

        const d = res.data;

        document.getElementById("unit-no").textContent = d.unit;
        document.getElementById("nama").textContent = d.nama || "-";
        document.getElementById("kondisi").textContent = d.kondisiunit || "-";

        document.getElementById("card-unit").classList.remove("hidden");

        /* RIWAYAT PERJANJIAN */
        if (d.riwayatPerjanjian && d.riwayatPerjanjian.length) {
          const tb = document.getElementById("tbl-perjanjian");
          d.riwayatPerjanjian.forEach((r, i) => {
            tb.insertAdjacentHTML("beforeend", `
              <tr>
                <td class="px-3 py-2">${i + 1}</td>
                <td class="px-3 py-2">${r.no_perjanjian_penghuni || "-"}</td>
                <td class="px-3 py-2">${r.tgl_mulai || "-"}</td>
                <td class="px-3 py-2">${r.tgl_akhir || "-"}</td>
              </tr>
            `);
          });
          document.getElementById("riwayat-perjanjian").classList.remove("hidden");
        }

        /* RIWAYAT TUNGGAKAN */
        if (d.riwayatPenghuniDetail && d.riwayatPenghuniDetail.length) {
          const tb = document.getElementById("tbl-tunggakan");
          d.riwayatPenghuniDetail.forEach(r => {
            tb.insertAdjacentHTML("beforeend", `
              <tr>
                <td class="px-3 py-2">${r.nama || "-"}</td>
                <td class="px-3 py-2 text-right">${r.uang_tunggak_24 || 0}</td>
                <td class="px-3 py-2 text-right">${r.uang_tunggak_25 || 0}</td>
                <td class="px-3 py-2 text-right">${r.uang_tunggak_26 || 0}</td>
              </tr>
            `);
          });
          document.getElementById("riwayat-tunggakan").classList.remove("hidden");
        }
      })
      .catch(err => {
        showAlert("Koneksi gagal ke server");
        console.error(err);
      });
  </script>
</body>
</html>
