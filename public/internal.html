<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Internal Rusun</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-950 text-white">

<div class="flex min-h-screen">

  <!-- SIDEBAR -->
  <div class="w-64 bg-slate-900 p-4">
    <h1 class="text-xl font-bold mb-6">üè† RUSUN DASHBOARD</h1>
    <div class="text-slate-400 mb-4">Manajemen Penghuni</div>
    <button onclick="logout()" class="text-red-500">Logout</button>
  </div>

  <!-- MAIN -->
  <div class="flex-1 p-8">
    <h2 class="text-2xl font-bold mb-6">Dashboard Internal</h2>

    <div class="grid grid-cols-4 gap-4 mb-8">
      <div class="bg-slate-800 p-4 rounded">Penghuni<br><b id="penghuni">-</b></div>
      <div class="bg-slate-800 p-4 rounded">Unit Terisi<br><b id="unitTerisi">-</b></div>
      <div class="bg-slate-800 p-4 rounded">Total Bayar<br><b id="totalBayar">Rp 0</b></div>
      <div class="bg-slate-800 p-4 rounded">Total Tunggakan<br><b id="totalTunggakan">Rp 0</b></div>
    </div>

    <div class="bg-slate-900 p-6 rounded">
      <h3 class="text-lg font-bold mb-4">Daftar Penghuni</h3>
      <input id="search" oninput="filter()" class="w-full p-2 rounded bg-slate-800 mb-4" placeholder="Cari unit / nama...">

      <div class="overflow-auto max-h-[500px]">
        <table class="w-full text-sm">
          <thead class="text-slate-400">
            <tr>
              <th class="p-2 text-left">Unit</th>
              <th class="p-2 text-left">Nama</th>
              <th class="p-2 text-left">No Telp</th>
              <th class="p-2 text-left">Kondisi</th>
              <th class="p-2 text-right">Bayar</th>
              <th class="p-2 text-right">Tunggakan</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script>
if(localStorage.getItem("login")!=="ok"){
  location.href="/login.html";
}

const penghuni = document.getElementById("penghuni");
const unitTerisi = document.getElementById("unitTerisi");
const totalBayar = document.getElementById("totalBayar");
const totalTunggakan = document.getElementById("totalTunggakan");
const tbody = document.getElementById("tbody");

let cache = [];

fetch("/api/data?action=internal&key=rusun2026")
.then(r=>r.json())
.then(res=>{
  const sum = res.data.summary;
  const data = res.data.data;

  penghuni.innerText = sum.penghuni;
  unitTerisi.innerText = sum.terisi;
  totalBayar.innerText = "Rp " + sum.totalBayar.toLocaleString("id-ID");
  totalTunggakan.innerText = "Rp " + sum.totalTunggakan.toLocaleString("id-ID");

  cache = data;
  render(data);
});

function render(data){
  tbody.innerHTML = "";
  data.forEach(r=>{
    tbody.innerHTML += `
      <tr class="border-b border-slate-800">
        <td class="p-2">${r.unit}</td>
        <td class="p-2">${r.nama}</td>
        <td class="p-2">${r.notelp}</td>
        <td class="p-2">${r.kondisiunit}</td>
        <td class="p-2 text-right">Rp ${Number(r.pembayaran).toLocaleString("id-ID")}</td>
        <td class="p-2 text-right">Rp ${Number(r.tunggakan).toLocaleString("id-ID")}</td>
      </tr>`;
  });
}

function filter(){
  const q = search.value.toLowerCase();
  render(cache.filter(x =>
    x.unit.toLowerCase().includes(q) ||
    x.nama.toLowerCase().includes(q)
  ));
}

function logout(){
  localStorage.removeItem("login");
  location.href="/login.html";
}
</script>

</body>
</html>
