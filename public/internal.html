<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Internal Rusun</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-950 text-white min-h-screen">

<div class="flex">

  <!-- SIDEBAR -->
  <div class="w-64 bg-slate-900 p-5 space-y-4">
    <h1 class="text-xl font-bold">üè† RUSUN DASHBOARD</h1>
    <div class="text-slate-400">Manajemen Penghuni</div>
    <div class="text-red-500 cursor-pointer">Logout</div>
  </div>

  <!-- CONTENT -->
  <div class="flex-1 p-6">

    <h1 class="text-2xl font-bold mb-4">Dashboard Internal</h1>

    <!-- CARD -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-slate-800 p-4 rounded-xl">Penghuni<br><b id="tp" class="text-2xl">0</b></div>
      <div class="bg-slate-800 p-4 rounded-xl">Unit Terisi<br><b id="ut" class="text-2xl">0</b></div>
      <div class="bg-slate-800 p-4 rounded-xl">Total Bayar<br><b id="tb" class="text-2xl">Rp 0</b></div>
      <div class="bg-slate-800 p-4 rounded-xl">Total Tunggakan<br><b id="tt" class="text-2xl">Rp 0</b></div>
    </div>

    <!-- TABLE -->
    <div class="bg-slate-900 rounded-xl p-4">

      <h2 class="font-bold mb-2">Daftar Penghuni</h2>

      <input id="search" placeholder="Cari unit / nama..."
        class="w-full mb-3 px-3 py-2 rounded bg-slate-800 border border-slate-700 outline-none">

      <div class="overflow-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-slate-700 text-left">
            <th class="py-2">Unit</th>
            <th>Nama</th>
            <th>No Telp</th>
            <th>Status</th>
            <th>Total Bayar</th>
            <th>Total Tunggakan</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      </div>

    </div>

  </div>
</div>

<script>
const tbody = document.getElementById("tbody");
const tp = document.getElementById("tp"); // penghuni
const ut = document.getElementById("ut"); // unit terisi
const tb = document.getElementById("tb"); // total bayar
const tt = document.getElementById("tt"); // total tunggakan
const search = document.getElementById("search");

let ALL = [];

// PAKAI PROXY VERCEL
fetch("https://script.google.com/macros/s/AKfycbzjABRVgRaoMj3Y1gCU_DRJpnZIvkGwxRRxmPW6buV1POsQ87GQCLAeEBG5j9jJZux7iQ/exec?action=internal&key=rusun2026")
 .then(r => r.json())
 .then(res => {
    console.log("API INTERNAL:", res);

    const sum  = res.data.summary;
    const data = res.data.data;

    // CARD
    tp.innerText = sum.penghuni;
    ut.innerText = sum.terisi;
    tb.innerText = "Rp " + Number(sum.totalBayar).toLocaleString("id-ID");
    tt.innerText = "Rp " + Number(sum.totalTunggakan).toLocaleString("id-ID");

    // SIMPAN DATA UNTUK SEARCH
    ALL = data;

    render(data);
 })
 .catch(err=>{
   console.error("ERROR LOAD INTERNAL:", err);
 });

function render(data){
  let html = "";

  data.forEach(p=>{
    html += `
    <tr class="border-b border-slate-800 hover:bg-slate-800/50">
      <td class="py-2">${(p.unit||"").toUpperCase()}</td>
      <td>${p.nama || ""}</td>
      <td>${p.notelp || ""}</td>
      <td>${p.kondisiunit || ""}</td>
      <td>Rp ${Number(p.pembayaran||0).toLocaleString("id-ID")}</td>
      <td>Rp ${Number(p.tunggakan||0).toLocaleString("id-ID")}</td>
    </tr>`;
  });

  tbody.innerHTML = html;
}

search.addEventListener("input", ()=>{
  const q = search.value.toLowerCase();
  const f = ALL.filter(p=>{
    return (p.unit||"").toLowerCase().includes(q) ||
           (p.nama||"").toLowerCase().includes(q);
  });
  render(f);
});
</script>

</body>
</html>

